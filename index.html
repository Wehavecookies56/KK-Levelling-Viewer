<html>
	<head>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300italic,700,700italic">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/milligram/1.4.1/milligram.min.css">
		<style>
			body{
				background-color:#202124;
				color:#FFFFFF;
			}
			table {
				margin: auto;
				width: 50%;
				padding: 10px;
			}
            th {
              background-color:#202124;
              position: sticky;
              top: 0;
            }
			.level:hover { 
				color:yellow;
				border: 1px solid yellow;
			}
            td {
                border-color: #6e6e6e;
            }
			
			.level:hover td{
                border-color: yellow;
            }
		</style>
	</head>
	<body>
		<input type="file" id="file-selector"><br>
		<input type="checkbox" id="namespaces" class="namespaces" style="position:sticky;">Show namespaces</input>

		<table id="output">
			
		</table>
		<script>
            function writeStat(stat,tr){
				if(stat) {
					let plus = stat >= 0;
					const td = tr.insertCell();
					if(stat <0){
						td.style.color = "red"
					}
					td.appendChild(document.createTextNode((plus ? "+" : "")+stat))
				} else {
					const td = tr.insertCell();
					td.style.color = "#888"
					td.appendChild(document.createTextNode("N/A"))
				}
			}
			
			function writeStatArray(stat,tr){
				if(stat) {
				    const td = tr.insertCell();
					if(stat <0){
						td.style.color = "red"
					}
					namespaces = document.querySelector('.namespaces').checked;
					if(namespaces) {
						let text = "";
						for(let j = 0; j < stat.length;j++){
							text += String(stat[j])+", "
						}
						td.appendChild(document.createTextNode(text.substring(0,text.length-2)))
					} else {
					let text = "";
						for(let j = 0; j < stat.length;j++){
							text += String(stat[j]).substring(String(stat[j]).indexOf(":") + 1)+", "
						}
						td.appendChild(document.createTextNode(text.substring(0,text.length-2)))
					}
				} else {
					const td = tr.insertCell();
					td.style.color = "#888"
					td.appendChild(document.createTextNode("N/A"))
				}
			}
			
			function loadTable(file){
			console.log(file)
				table = document.getElementById('output');
				table.border = 0;
				table.innerHTML = "";
				console.log(file.name)
				var fr = new FileReader();
				fr.onload=function(){
					const obj = JSON.parse(fr.result);
                        var thead = table.createTHead();
						const firstHeader = thead.insertRow();
						nameCell = firstHeader.insertCell();
						nameCell.appendChild(document.createTextNode(file.name.substring(0,file.name.indexOf("."))))
						nameCell.colSpan = 9;
						nameCell.style = "font-size:36px; text-align:center;";
						
						const header = table.insertRow();
						header.insertCell().outerHTML = "<th>Level</th>";
						header.insertCell().outerHTML = "<th>Strength</th>";
						header.insertCell().outerHTML = "<th>Magic</th>";
						header.insertCell().outerHTML = "<th>Defense</th>";
						header.insertCell().outerHTML = "<th>AP</th>";
						header.insertCell().outerHTML = "<th>Max HP</th>";
						header.insertCell().outerHTML = "<th>Max MP</th>";
						header.insertCell().outerHTML = "<th>Abilities</th>";
						header.insertCell().outerHTML = "<th>Shotlocks</th>";

                    var tbody = table.createTBody();
					for (let i = 0; i <= 100; i++) {
						const tr = tbody.insertRow();
						tr.className = "level"

						let level = obj[i];
						const td = tr.insertCell();
						
						td.appendChild(document.createTextNode(i))
						writeStat(level.str,tr)
						writeStat(level.mag,tr)
						writeStat(level.def,tr)
						writeStat(level.ap,tr)
						writeStat(level.maxhp,tr)
						writeStat(level.maxmp,tr)
						writeStatArray(level.abilities,tr)
						writeStatArray(level.shotlocks,tr)
					}
					
				}
				
				fr.readAsText(file);
			}
			
			const fileSelector = document.getElementById('file-selector');
			fileSelector.addEventListener('change', (event) => {
				const files = event.target.files;
				loadTable(files[0]);
			  });
			  
			const checkbox = document.getElementById('namespaces');
			checkbox.addEventListener('change', (event) => {
				const file = fileSelector.files[0];
				loadTable(file);
			  });

		</script>
	</body>
</html>
